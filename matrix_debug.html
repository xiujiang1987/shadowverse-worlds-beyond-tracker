<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ©é™£åˆ‡æ› Debug å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
        }
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        .matrix-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 25px;
            color: #fff;
            margin: 5px;
            cursor: pointer;
        }
        .matrix-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        .matrix-table-container {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        .matrix-table-container.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #444;
            padding: 8px;
            text-align: center;
        }
        .debug-info {
            background: rgba(255, 255, 0, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>çŸ©é™£åˆ‡æ› Debug å·¥å…·</h1>
        
        <!-- è¼‰å…¥æ•¸æ“šå€ -->
        <div class="debug-section">
            <h3>1. è¼‰å…¥æ•¸æ“šæ¸¬è©¦</h3>
            <input type="file" id="dataFile" accept=".json">
            <button onclick="loadTestData()">è¼‰å…¥æ¸¬è©¦æ•¸æ“š</button>
            <div id="dataStatus" class="debug-info">è«‹é¸æ“‡JSONæª”æ¡ˆæˆ–é»æ“Šè¼‰å…¥æ¸¬è©¦æ•¸æ“š</div>
        </div>

        <!-- çŸ©é™£åˆ‡æ›æ¸¬è©¦ -->
        <div class="debug-section">
            <h3>2. çŸ©é™£åˆ‡æ›æ¸¬è©¦</h3>
            <button class="matrix-btn active" onclick="showMatrixType('first')" id="firstMatrixBtn">ğŸ”´ å…ˆæ‰‹å‹ç‡çŸ©é™£</button>
            <button class="matrix-btn" onclick="showMatrixType('second')" id="secondMatrixBtn">ğŸ”µ å¾Œæ‰‹å‹ç‡çŸ©é™£</button>
            
            <div id="currentType" class="debug-info">ç•¶å‰é¡¯ç¤ºï¼šå…ˆæ‰‹</div>
            
            <!-- å…ˆæ‰‹çŸ©é™£ -->
            <div id="firstMatrix" class="matrix-table-container active">
                <h4>å…ˆæ‰‹å‹ç‡çŸ©é™£</h4>
                <div id="firstMatrixContent">ç­‰å¾…æ•¸æ“šè¼‰å…¥...</div>
            </div>
            
            <!-- å¾Œæ‰‹çŸ©é™£ -->
            <div id="secondMatrix" class="matrix-table-container">
                <h4>å¾Œæ‰‹å‹ç‡çŸ©é™£</h4>
                <div id="secondMatrixContent">ç­‰å¾…æ•¸æ“šè¼‰å…¥...</div>
            </div>
        </div>

        <!-- æ•¸æ“šè©³æƒ… -->
        <div class="debug-section">
            <h3>3. æ•¸æ“šè©³æƒ…</h3>
            <div id="dataDetails" class="debug-info">ç„¡æ•¸æ“š</div>
        </div>
    </div>

    <script>
        const CLASS_LIST = ['ç²¾éˆ', 'çš‡å®¶', 'å·«å¸«', 'é¾', 'å¤œé­”', 'å¾©ä»‡è€…', 'ä¸»æ•™'];
        let matrixData = null;

        // è¼‰å…¥æ¸¬è©¦æ•¸æ“š
        function loadTestData() {
            // æ¨¡æ“¬æ¸¬è©¦æ•¸æ“š
            const testData = {
                battleData: [
                    {id: 1, myClass: 'å¾©ä»‡è€…', opponentClass: 'çš‡å®¶', result: 'å‹', turnOrder: 'å…ˆæ‰‹'},
                    {id: 2, myClass: 'å¾©ä»‡è€…', opponentClass: 'çš‡å®¶', result: 'æ•—', turnOrder: 'å¾Œæ‰‹'},
                    {id: 3, myClass: 'ç²¾éˆ', opponentClass: 'é¾', result: 'å‹', turnOrder: 'å¾Œæ‰‹'},
                    {id: 4, myClass: 'ç²¾éˆ', opponentClass: 'å·«å¸«', result: 'æ•—', turnOrder: 'å…ˆæ‰‹'},
                    {id: 5, myClass: 'å¾©ä»‡è€…', opponentClass: 'ç²¾éˆ', result: 'å‹', turnOrder: 'å¾Œæ‰‹'},
                ]
            };
            processData(testData);
        }

        // è™•ç†æ•¸æ“š
        function processData(data) {
            const matrix = {
                first: {},
                second: {}
            };

            // åˆå§‹åŒ–çŸ©é™£
            CLASS_LIST.forEach(myClass => {
                matrix.first[myClass] = {};
                matrix.second[myClass] = {};
                CLASS_LIST.forEach(opponentClass => {
                    matrix.first[myClass][opponentClass] = { wins: 0, total: 0, winRate: 0 };
                    matrix.second[myClass][opponentClass] = { wins: 0, total: 0, winRate: 0 };
                });
            });

            // çµ±è¨ˆå°æˆ°æ•¸æ“š
            data.battleData.forEach(battle => {
                const { myClass, opponentClass, result, turnOrder } = battle;
                
                if (!turnOrder || !CLASS_LIST.includes(myClass) || !CLASS_LIST.includes(opponentClass)) {
                    return;
                }

                const turnMatrix = turnOrder === 'å…ˆæ‰‹' ? matrix.first : matrix.second;
                
                if (turnMatrix[myClass] && turnMatrix[myClass][opponentClass]) {
                    turnMatrix[myClass][opponentClass].total++;
                    if (result === 'å‹') {
                        turnMatrix[myClass][opponentClass].wins++;
                    }
                    
                    const total = turnMatrix[myClass][opponentClass].total;
                    const wins = turnMatrix[myClass][opponentClass].wins;
                    turnMatrix[myClass][opponentClass].winRate = total > 0 ? Math.round((wins / total) * 100) : 0;
                }
            });

            matrixData = matrix;
            updateDataStatus(`æ•¸æ“šè¼‰å…¥æˆåŠŸï¼ç¸½å°æˆ°ï¼š${data.battleData.length}å ´`);
            renderMatrixes();
            showDataDetails();
        }

        // æ¸²æŸ“çŸ©é™£
        function renderMatrixes() {
            if (!matrixData) return;

            renderMatrix('first', matrixData.first, 'firstMatrixContent');
            renderMatrix('second', matrixData.second, 'secondMatrixContent');
        }

        function renderMatrix(type, data, containerId) {
            const container = document.getElementById(containerId);
            if (!container || !data) return;

            let html = '<table>';
            html += '<thead><tr><th>æˆ‘æ–¹\\å°æ‰‹</th>';
            CLASS_LIST.forEach(opponentClass => {
                html += `<th>${opponentClass}</th>`;
            });
            html += '</tr></thead>';

            html += '<tbody>';
            CLASS_LIST.forEach(myClass => {
                html += `<tr><th>${myClass}</th>`;
                CLASS_LIST.forEach(opponentClass => {
                    const stats = data[myClass][opponentClass];
                    const cellContent = stats.total > 0 ? `${stats.winRate}%` : '--';
                    const color = stats.winRate >= 70 ? '#4CAF50' : 
                                 stats.winRate >= 50 ? '#FFC107' : 
                                 stats.total > 0 ? '#F44336' : '#666';
                    
                    html += `<td style="background-color: ${color}; color: white;">
                                ${cellContent}<br><small>(${stats.wins}/${stats.total})</small>
                             </td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';

            container.innerHTML = html;
        }

        // åˆ‡æ›çŸ©é™£é¡å‹
        function showMatrixType(type) {
            const firstBtn = document.getElementById('firstMatrixBtn');
            const secondBtn = document.getElementById('secondMatrixBtn');
            const firstMatrix = document.getElementById('firstMatrix');
            const secondMatrix = document.getElementById('secondMatrix');
            const currentType = document.getElementById('currentType');

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            firstBtn.classList.toggle('active', type === 'first');
            secondBtn.classList.toggle('active', type === 'second');

            // æ›´æ–°çŸ©é™£é¡¯ç¤º
            firstMatrix.classList.toggle('active', type === 'first');
            secondMatrix.classList.toggle('active', type === 'second');

            // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
            currentType.textContent = `ç•¶å‰é¡¯ç¤ºï¼š${type === 'first' ? 'å…ˆæ‰‹' : 'å¾Œæ‰‹'}`;

            console.log(`åˆ‡æ›åˆ°${type === 'first' ? 'å…ˆæ‰‹' : 'å¾Œæ‰‹'}çŸ©é™£`);
        }

        // æ›´æ–°æ•¸æ“šç‹€æ…‹
        function updateDataStatus(message) {
            document.getElementById('dataStatus').textContent = message;
        }

        // é¡¯ç¤ºæ•¸æ“šè©³æƒ…
        function showDataDetails() {
            if (!matrixData) return;

            let details = '<h4>çŸ©é™£æ•¸æ“šçµ±è¨ˆï¼š</h4>';
            
            ['first', 'second'].forEach(type => {
                const typeName = type === 'first' ? 'å…ˆæ‰‹' : 'å¾Œæ‰‹';
                let totalBattles = 0;
                
                Object.keys(matrixData[type]).forEach(myClass => {
                    Object.keys(matrixData[type][myClass]).forEach(opponentClass => {
                        totalBattles += matrixData[type][myClass][opponentClass].total;
                    });
                });
                
                details += `<p><strong>${typeName}å°æˆ°ç¸½æ•¸ï¼š</strong>${totalBattles}å ´</p>`;
            });

            document.getElementById('dataDetails').innerHTML = details;
        }

        // æª”æ¡ˆä¸Šå‚³è™•ç†
        document.getElementById('dataFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        processData(data);
                    } catch (error) {
                        updateDataStatus(`æª”æ¡ˆè¼‰å…¥å¤±æ•—ï¼š${error.message}`);
                    }
                };
                reader.readAsText(file);
            }
        });
    </script>
</body>
</html>
